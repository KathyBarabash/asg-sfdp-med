# ASG-SFDP

**ASG-SFDP** is a FastAPI-based data-serving app, created automatically by the **ASG-tool** and, at runtime, dependent on the **asg-runtime** library.

## Features

ASG-SFDP inherits its features from the **asg-runtime** library and supports the following endpoints:

### Service Endpoints

- `/service/stats`
- `/service/settings`
- `/service/origin_cache/clean`
- `/service/response_cache/clean`

### Data Endpoints

These are one or more endpoints under the `/data/` path, generated by the ASG-tool according to the FDP-to-SFDP contract specification.

## Configuration

ASG-SFDP can be configured through environment variables.  
Example settings are provided in the [.env file](./.env), which can be modified to adjust the runtime behavior of the SFDP app.

## Installation and Usage

There are several options to install and run the SFDP.

### Locally from Sources

To run SFDP locally:

1. Clone the repository and enter the cloned directory.
2. Create and activate a fresh Python 3.12 virtual environment.

Then install dependencies and start the service:

```sh
pip install -r requirements.txt

uvicorn app:app
```

To run the service in development mode:

```sh
pip install -r requirements-dev.txt

fastapi dev
```

### As a Locally Created Container Image

On a system that supports containerization (e.g., Docker, Podman), you can build and run a local container image:

```sh
# Build a local image (replace <asg-sfdp> with your desired image name)
docker build -t <asg-sfdp>:local .
```

**Note:**  
If you are building inside a VM and encounter network issues, try:

```sh
docker build --network=host -t <asg-sfdp>:local .
```

If this does not help, you might need additional infrastructure troubleshooting.  
*(TODO: Add instructions)*

Once the image is created (check with `docker images`), you can run the container:

```sh
docker run -it --rm -p 8000:8000 <asg-sfdp>:local
```

Again, if running inside a VM with networking issues, you can run with host networking:

```sh
docker run --rm -it --network=host <asg-sfdp>:local
```

## Accessing the Service

When the SFDP app is running, its endpoints can be accessed either through a web browser or tools like `curl`.

## Directory Structure

```plaintext
.
├── .env                # Example settings
├── Dockerfile          # Defines how to containerize the app
├── app.py              # The main FastAPI application
├── requirements.txt    # Production dependencies
├── requirements-dev.txt# Development-only dependencies
├── transforms/         # Folder containing data transformation functions
```

